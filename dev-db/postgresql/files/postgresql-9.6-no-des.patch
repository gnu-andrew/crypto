--- a/contrib/pgcrypto/openssl.c.orig	2016-10-24 21:08:51.000000000 +0100
+++ b/contrib/pgcrypto/openssl.c	2016-11-16 05:33:47.575206796 +0000
@@ -36,7 +36,9 @@
 #include <openssl/evp.h>
 #include <openssl/blowfish.h>
 #include <openssl/cast.h>
+#ifndef OPENSSL_NO_DES
 #include <openssl/des.h>
+#endif
 #include <openssl/rand.h>
 #include <openssl/err.h>
 
@@ -411,6 +413,7 @@
 			BF_KEY		key;
 			int			num;
 		}			bf;
+#ifndef OPENSSL_NO_DES
 		struct
 		{
 			DES_key_schedule key_schedule;
@@ -421,6 +424,7 @@
 						k2,
 						k3;
 		}			des3;
+#endif
 		CAST_KEY	cast_key;
 		AES_KEY		aes_key;
 	}			u;
@@ -594,6 +598,8 @@
 	return 0;
 }
 
+#ifndef OPENSSL_NO_DES
+
 /* DES */
 
 static int
@@ -751,6 +757,8 @@
 	return 0;
 }
 
+#endif
+
 /* CAST5 */
 
 static int
@@ -934,10 +942,12 @@
 	{"blowfish-cbc", "bf-cbc"},
 	{"blowfish-ecb", "bf-ecb"},
 	{"blowfish-cfb", "bf-cfb"},
+#ifndef OPENSSL_NO_DES
 	{"des", "des-cbc"},
 	{"3des", "des3-cbc"},
 	{"3des-ecb", "des3-ecb"},
 	{"3des-cbc", "des3-cbc"},
+#endif
 	{"cast5", "cast5-cbc"},
 	{"aes", "aes-cbc"},
 	{"rijndael", "aes-cbc"},
@@ -961,6 +971,7 @@
 	64 / 8, 448 / 8, 1
 };
 
+#ifndef OPENSSL_NO_DES
 static const struct ossl_cipher ossl_des_ecb = {
 	ossl_des_init, ossl_des_ecb_encrypt, ossl_des_ecb_decrypt,
 	64 / 8, 64 / 8, 0
@@ -980,6 +991,7 @@
 	ossl_des3_init, ossl_des3_cbc_encrypt, ossl_des3_cbc_decrypt,
 	64 / 8, 192 / 8, 0
 };
+#endif
 
 static const struct ossl_cipher ossl_cast_ecb = {
 	ossl_cast_init, ossl_cast_ecb_encrypt, ossl_cast_ecb_decrypt,
@@ -1014,10 +1026,12 @@
 	{"bf-cbc", &ossl_bf_cbc},
 	{"bf-ecb", &ossl_bf_ecb},
 	{"bf-cfb", &ossl_bf_cfb},
+#ifndef OPENSSL_NO_DES
 	{"des-ecb", &ossl_des_ecb},
 	{"des-cbc", &ossl_des_cbc},
 	{"des3-ecb", &ossl_des3_ecb},
 	{"des3-cbc", &ossl_des3_cbc},
+#endif
 	{"cast5-ecb", &ossl_cast_ecb},
 	{"cast5-cbc", &ossl_cast_cbc},
 	{"aes-ecb", &ossl_aes_ecb},
